#################################################
#  PHP App Twig Template
#  (c) 2016 Inkton
#################################################
#!/bin/sh

. /opt/sbin/nest-twig/base.twig
. /opt/sbin/nest-twig/frameworks/php-5.6.twig

app_init() {
	NEST_SITE_HOME=example.org
	NEST_SITE_EMAIL=contact@example.org
	NEST_SITE_ORG="Example Inc"
}

app_shutdown() {
	yell "<- app shutdown  ->"
}

app_before_install() {
	yell "-> app_before_install"; 

	NEST_DB_PASSWORD=9999
	
	NEST_MAX_LOG_SIZE=1048576
	NEST_PHP_TIMEZONE="US/Central"
	NEST_PHP_FILE_UPLOAD=20
	NEST_PHP_UPLOAD_MAX_FILESIZE=2M
	NEST_PHP_POST_MAX_SIZE=2M
	NEST_PHP_MAX_EXECUTION_TIME=180	
}

app_before_upgrade() {
	yell "-> app_before_upgrade"; 
} 

app_before_up() {
	yell "-> app_before_up"; 
}

app_before_daily() {
	yell "-> app_before_daily"; 
	
	# called anytime between 0-1 HRS UTC

	if [ $NEST_CUSHION_MASTER -eq 1 ]; then

		# running aginst the master ensures
		# the job is only run once. if not 
		# the job will be run on all cushions.
		
		if [[ $(date +%u) -eq 1 ]] ; then
			yell "-> do weekly tasks "; 
		fi
		
		if [[ $(date +%d) -eq 1  ]]; then
			yell "-> do monthly tasks "; 
		fi

	fi
}

twig_links_begin
	link_twigs base php
	link_twigs php app
twig_links_end

